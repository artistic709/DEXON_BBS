<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>交易手續費的科普小教室</title><meta property="name" content="交易手續費的科普小教室"><meta property="description" content="前幾天有人問說為什麼推文消耗的gas比發文還多  既然你誠心誠意的發問了，我就..解釋一下吧    會寫 Solidity 的可以稍微看一下合約  https://dexscan.app/address/0x66300"><meta property="image" content="https://dett.cc/assets/meta.png"><meta property="og:title" content="交易手續費的科普小教室"><meta property="og:description" content="前幾天有人問說為什麼推文消耗的gas比發文還多  既然你誠心誠意的發問了，我就..解釋一下吧    會寫 Solidity 的可以稍微看一下合約  https://dexscan.app/address/0x66300"><meta property="og:url" content="https://dett.cc/s/hSPQZK"><meta property="og:type" content="website"><meta property="og:image" content="https://dett.cc/assets/meta.png"><meta property="og:image:width" content="830"><meta property="og:image:height" content="480"><meta property="dett:tx" content="0xe996fd7975c9fe3ada8bc4c488733efc6bcbf750a2e552ba17059e677c1e87a5"><link rel="canonical" href="https://dett.cc/s/hSPQZK"><link rel="shortcut icon" type="image/png" href="/icon.9c86b69e.png"><link rel="stylesheet" type="text/css" href="https://images.ptt.cc/bbs/v2.25/bbs-common.css"><link rel="stylesheet" type="text/css" href="https://images.ptt.cc/bbs/v2.25/bbs-base.css" media="screen"><link rel="stylesheet" type="text/css" href="https://images.ptt.cc/bbs/v2.25/bbs-custom.css"><link rel="stylesheet" type="text/css" href="https://images.ptt.cc/bbs/v2.25/pushstream.css" media="screen"><link rel="stylesheet" type="text/css" href="https://images.ptt.cc/bbs/v2.25/bbs-print.css" media="print"><link rel="stylesheet" type="text/css" href="/style.d7ce259d.css"></head><body> <div id="topbar-container"> <div id="topbar" class="bbs-content"> <a id="logo" href="/" aria-label="DEXON BBS"><svg xmlns="http://www.w3.org/2000/svg" class="svglogo" width="100" height="46" viewBox="0 0 160 46"><title>DEXON</title><path fill="#ffff66" fill-rule="evenodd" d="M29.444 9.308L34.834 0l13.273 22.914L34.835 45.83l-5.391-9.308-5.39 9.308-5.392-9.308-5.39 9.308L0 22.914 13.272 0l5.39 9.308L24.053 0l5.39 9.308zm2.49 22.914l2.9 5.009 8.293-14.317-8.292-14.316-2.901 5.009 5.39 9.307-5.39 9.308zM21.152 13.607l2.901 5.008 2.901-5.008-2.9-5.009-2.902 5.009zM4.98 22.914l8.292 14.317 2.9-5.009-5.39-9.308 5.39-9.307-2.9-5.009L4.98 22.914zm21.563 0l2.9 5.01 2.902-5.01-2.901-5.008-2.901 5.008zm-10.782 0l2.901 5.01 2.901-5.01-2.9-5.008-2.902 5.008zm5.391 9.308l2.901 5.009 2.901-5.009-2.9-5.008-2.902 5.008zm48.184-6.737v-5.142c0-2.37-1.934-4.299-4.312-4.299H60.71v13.74h4.313c2.378 0 4.312-1.928 4.312-4.299zm-4.312-13.74c4.763 0 8.625 3.85 8.625 8.598v5.142c0 4.75-3.862 8.599-8.625 8.599h-8.626V11.745h8.626zm69.002 13.74v-5.142c0-2.37-1.935-4.299-4.313-4.299a4.31 4.31 0 0 0-4.312 4.3v5.142c0 2.37 1.934 4.299 4.312 4.299s4.313-1.929 4.313-4.3zm-4.313-13.74c4.764 0 8.626 3.85 8.626 8.598v5.143c0 4.748-3.862 8.598-8.626 8.598-4.763 0-8.625-3.85-8.625-8.598v-5.143c0-4.748 3.862-8.598 8.625-8.598zm-17.584 0h4.98l-6.469 11.17 6.47 11.169h-4.98l-3.98-6.87-3.979 6.87h-4.98l6.47-11.17-6.47-11.169h4.98l3.98 6.87 3.978-6.87zm-19.407 4.3H82.274v4.72h8.625v4.299h-8.625v4.72l10.448.001 2.49 4.299h-17.25V11.745h17.25l-2.49 4.3zm62.867-4.3h4.313v22.339h-4.646l-8.292-14.316v14.316h-4.313V11.745h4.647l8.291 14.317V11.745z"></path></svg>
BBS</a> <span>›</span> <a class="board" href="/"><span class="board-label">看板 </span>Gossiping</a> <div id="bbs-user-menu" class="user-menu right" href="#" style="display:none;"> <div id="bbs-user" class="trigger right small">User</div> <div class="dropdown" style="width:100%"> <div class="item small"><a href="/about.html">幫助</a></div> <div class="hotkey-mode-btn item small"><a href="#"><span class="hotkey-mode"></span>熱鍵</a></div> <div class="item small"><a href="/register.html">註冊暱稱</a></div> <div class="item small"><a href="#" data-toggle="modal" data-target="#loginModal">切換帳號</a></div> </div> </div> <a id="bbs-login" class="user-menu right small" href="#" data-toggle="modal" data-target="#loginModal">登入</a> <div id="bbs-more" class="user-menu right"> <div class="trigger right small">⋯</div> <div class="dropdown"> <div class="item small"><a href="/about.html">幫助</a></div> <div class="hotkey-mode-btn item small"><a href="#"><span class="hotkey-mode"></span>熱鍵</a></div> </div> </div> </div> </div> <div id="navigation-container"> <div id="navigation" class="bbs-content"> <a class="board" href="/">返回看板</a> <div class="bar"></div> <a id="reply-btn" class="board" href="#" style="display:none;">推文(X)</a> <a id="reply-type1" class="board" href="#" style="color:#990;display:none;"> 推(1) </a> <a id="reply-type2" class="board" href="#" style="color:#f66;display:none;"> 噓(2) </a> <a id="reply-type0" class="board" href="#" style="display:none;"> →(3) </a> <a id="reply-send" class="board" href="#" style="display:none;">送出推文(^↵)</a> <a id="reply-cancel" class="board" href="#" style="display:none;">取消推文</a> </div>
</div> <div id="main-container"> <div id="main-content" class="bbs-screen bbs-content" itemscope itemtype="http://schema.org/Article"> <meta itemprop="image" content="https://dett.cc/assets/meta.png"> <header id="article-metaline"> <div class="article-metaline" itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="article-meta-tag">作者</span><span class="article-meta-value"><span id="main-content-author" itemprop="name">admin</span></span></div> <div class="article-metaline-right"><span class="article-meta-tag">看板</span><span class="article-meta-value">Gossiping</span></div> <div class="article-metaline"><span class="article-meta-tag">標題</span><span class="article-meta-value" id="main-content-title" itemprop="headline">交易手續費的科普小教室</span></div> <div class="article-metaline"><span class="article-meta-tag">時間</span><time class="article-meta-value" id="main-content-date" itemprop="datePublished" datetime="2019-05-16T17:26:52.523Z">Fri May 17 2019 01:26:52</time></div> </header> <br> <main id="main-content-content" itemprop="articleBody">前幾天有人問說為什麼推文消耗的gas比發文還多

既然你誠心誠意的發問了，我就..解釋一下吧



會寫 Solidity 的可以稍微看一下合約

https://dexscan.app/address/0x663002C4E41E5d04860a76955A7B9B8234475952

簡單來說，整個 DEXON BBS 只有兩個 function：發文和推文

發文的話會把文字內容導到正宗的 BBS，然後噴出 event log

至於推文就比較複雜了

推文功能多了兩個參數：原文 ID、指令碼（代表推/噓/箭頭）

有原文 ID 才能讓網頁把留言正確的放到那篇文下面

然後指令碼除了用在網頁顯示

合約也會記下誰推過（避免重複推），並統計總推/噓數

看到這邊應該可以感覺到推文實際上比發文複雜了吧



如果還沒 end，接著再來看看 gas 計算的細節

因為 DEXON 是照搬 Ethereum 的智慧合約實作

我們可以直接參考 Ethereum 的 opcode - gas 對應表

https://github.com/djrtwo/evm-opcode-gas-costs/blob/master/opcode-gas-costs_EIP-150_revision-1e18248_2017-04-12.csv

通常一筆交易的 gas 會分四大塊討論

1. 基本費 21000
2. 交易掛載的資料費  68/B（非0）or 4/B（0）
3. 讀取資料和運算的費用（看表）
4. 寫入資料 20000/word（新宣告）or 5000/word（修改）

* word 是鏈上空間的最小單位，1 word = 32 Bytes

因為 BBS 沒啥鏈上運算，讀和運算大致可以忽略

只有 event 的費用是 375 + 8 * (number of bytes in log data)


所以以發文來說，gas 大約是

21000 + 375 + 文章長度 * (68+8)

而推文因為有鏈上寫入資料，情況會複雜一點

如果是推/噓，要考慮這篇文是不是已經有別人推/噓過

有人推過：5000（更新數字）+ 20000（記錄自己推過）
沒人推過：20000（新欄位） + 20000（記錄自己推過）

另外多掛載兩個參數：32 * 68 + 31 * 4 + 1 * 68 

所以在固定開銷上可以很明顯看到推文會貴一點

但因為推文有長度限制，發文沒有

所以發長文還是會比推文更貴，而且是越長越貴



另外就是 DEXON 目前有兩個比較怪異的設計

第一是限制 gas fee 一定要在 24 G 以上，否則直接拒收

我猜可能是要避免 spam，以太在早期也有 41 Gwei 的限制

第二是交易手續費的差額不會退還給使用者

如果你開 80000，實際只用了 50000，剩下 30000 也沒收

這點就跟 Ethereum 不太一樣了，或許是 feature 吧



大概是這樣

希望有解釋到推文手續費的疑惑

還有什麼問題就再問吧</main> <br> -- <br> <aside id="reward-line" style="display:none"> <span class="f2">※ 打賞作者: <button class="btn --send-reward" style="width:6em" data-value="0.01">0.01 DXN</button> <span id="reward-toggle-region-1"><button class="btn" style="width:4em" id="reward-customize">自訂</button> </span><span id="reward-toggle-region-2" style="display:none"><input id="reward-custom-value" type="number" class="input" step="any" min="0" style="width:6em"> <span class="f7">DXN</span> <button id="reward-custom-submit" class="btn" style="width:4em">確定</button></span></span> </aside> <div class="f2" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">※ 發信站: <span itemprop="name">DEXON BBS(dett.cc)</span>, 來自: <a id="main-content-from" target="_blank" href="#">DEXON</a><link itemprop="logo" href="/icon.9c86b69e.png"></div> <div class="f2">※ 文章網址: <a id="main-content-href" href="#" target="_blank" rel="nofollow"></a></div> <aside id="reply" style="display:none" aria-hidden=""><select id="reply-type" class="bbs-content select"> <option value="0">→</option> <option value="1">推</option> <option value="2">噓</option> </select> <span id="reply-user" class="f3 hl push-userid" style="color:#fff;vertical-align:middle;"></span><span class="f3 push-content" style="vertical-align:middle;color:#fff">: </span><span class="f3 push-content"></span><input class="main-content-content input" id="reply-content" type="text" maxlength="40" value=""></aside> <div class="comment"></div> <div class="edit"></div> </div>
</div> <link id="fragmentsSrc" href="/fragments.a16868bb.html"> <div id="fragments"></div> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/js/dist/util.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/js/dist/modal.js"></script> <script src="https://cdn.jsdelivr.net/gh/andy0130tw/web3.js-browser@v0.0.2-beta.55/build/web3.min.js"></script> <script src="/layout.be8e0bc5.js"></script> <script language="javascript" type="text/javascript" src="/content.88bcb857.js"></script>  <div id="wrapfabtest"> <div class="adBanner" style="background-color:transparent;height:1px;width:1px;"> </div> </div> <script async>$(document).ready(function(){var a=$("#wrapfabtest").height()>0?"//www.googletagmanager.com":a="//cdn.dett.cc",t=document.createElement("script");t.src=a+"/gtag/js?id=UA-140044770-1",document.body.appendChild(t),t.onload=function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","UA-140044770-1")}});</script> </body></html>